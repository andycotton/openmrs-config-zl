<htmlform id="hiv-plan"
          formUuid="e86e3118-731c-11e7-8cf7-a6006ad3dba0" formName="HIV Plan"
          formVersion="3.0">

    <style type="text/css">

        form fieldset {
            display: block;
        }

        #test-orders input[type=checkbox],
        #id-treatment, #family-plan-section {
            float: none;
            vertical-align: middle;
        }

        #test-orders p, #id-treatment p {
            margin-bottom: 5px
        }

        #test-orders span, #test-orders label {
            display: inline !important;
            vertical-align: middle;
        }

        #external-transfer-out input[type=checkbox],
        #external-transfer-in input[type=checkbox],
        .cb-align input[type=checkbox] {
            margin: 0px 5px;
            top:0px;
        }

        .two-columns {
            column-count: 2;
            -webkit-column-count: 2;
            -moz-column-count: 2;
        }

        .three-columns {
            column-count: 3;
            -webkit-column-count: 3;
            -moz-column-count: 3;
        }

        p.radio > * {
            display: inline;
            float: none !important;
            min-width: initial;
        }


        .section-container label,
        .section-container-color label {
            margin: 0px;
        }

        .section-container-color {
            background: #F2F2F2;
            box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
            padding: 10px 5px 10px 15px;
            line-height: 1.5em; /*add this for vertical spacing between elements*/
        }

       - .section {
        width: 100%;
        }

        label {
            padding: 0px 3px 0px 0px
        }

        .narrow {
            width: 200px;
        }
    </style>

    <ifMode mode="VIEW" include="false">
        <h1>
            <uimessage code="pihcore.visitNote.plan"/>
        </h1>
    </ifMode>

    <section id="radiology-orders" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.rad_order.title">
        <div class="section-container-color">
            <!-- Use PACS at HUM -->
            <repeat with="['Chest (X-ray)','CIEL:165152','chestXRay'],
                          ['Pelvic (U/S)', 'CIEL:161283', 'pelvicUS'],
                          ['Abdominal (U/S)','CIEL:845','abUS']">
                <p>
                    <obsgroup groupingConceptId="PIH:Radiology report construct">
                        <obs conceptId="PIH:Radiology procedure performed"
                             answerConceptId="{1}" toggle="{2}"
                             answerCode="pihcore.rad.{2}"
                             style="checkbox"/>
                        <div id="{2}" class="two-columns">
                            <obs conceptId="PIH:Radiology report comments"
                                 labelCode="pihcore.findings.label" />
                            <obs conceptId="PIH:12847" labelCode="Date" />
                        </div>
                    </obsgroup>
                </p>
            </repeat>

            <!-- this section is ONLY included for HIV intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                <p>
                    <label>
                        <uimessage code="zl.ifOtherSpecify"/>
                    </label>
                    <obsgroup groupingConceptId="PIH:Radiology report construct">
                        <obs conceptId="PIH:Radiology procedure performed"
                             answerClasses="Radiology/Imaging Procedure"
                             style="checkbox"/>
                        <div class="two-columns">
                            <obs conceptId="PIH:Radiology report comments"
                                 labelCode="pihcore.findings.label"/>
                            <obs conceptId="PIH:12847" labelCode="Date" />
                        </div>
                    </obsgroup>
                </p>
            </includeIf>
        </div>
    </section>


    <!-- ToDo: This section is duplicated by the section-lab-order.xml and should be replace
         with including forms within htmlforms.  Formlets? -->
    <section id="test-orders" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.ncd.labs.title">
        <div class="section-container-color">
            <!-- UHM-4784 Use Lab results or workflow to enter lab data.  Using includeif to comment out the section -->
            <includeIf velocityTest="$patient.gender == 'NoLabEntryHere' ">
                <div class="two-columns">
                    <obsgroup groupingConceptId="CIEL:164853">
                        <obs conceptId="CIEL:5497" labelCode="CD4"/>
                        <obs conceptId="CIEL:159951"
                             labelCode="CD4 Date:" allowTime="false" />
                    </obsgroup>
                </div>
                <hr/>
            </includeIf>

            <h4>
                <uimessage code="pihcore.labExam"/>
            </h4>

            <p>
                <!-- ToDo:  Toggle lab section with 'none' checkbox -->
                <obs conceptId="PIH:Lab test ordered coded"
                     answerConceptId="CIEL:1107"
                     style="checkbox" />
            </p>

            <div class="three-columns">
                <p>
                    <label>
                        <uimessage code="pihcore.lab.hematology.title"/>
                    </label>
                </p>
                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 style="checkbox"/>
                        </p>
                    </template>

                    <!-- Hematology -->
                    <render labName="CIEL:678" comment="WBC" />
                    <render labName="PIH:HEMOGLOBIN" comment="Hemoglobin"/>
                    <render labName="PIH:HEMATOCRIT" comment="Hematocrit"/>
                    <render labName="CIEL:1019" comment="Hematogram"/>
                    <render labName="CIEL:729" comment="Platelets" />
                    <render labName="PIH:1477" comment="ESR" />
                    <render labName="CIEL:161152" comment="Coagulation"/>
                    <render labName="PIH:BLOOD TYPING" comment="Blood group"/>
                    <render labName="CIEL:161233" comment="Crossmatching"/>
                    <render labName="CIEL:159644" comment="HbA1c"/>
                    <render labName="CIEL:160225" comment="Sickling"/>
                    <render labName="CIEL:165544" comment="Hemoglobin electrophoresis"/>
                </repeat>

                <!-- Parasitology -->
                <label>
                    <uimessage code="pihcore.lab.parasitology.title"/>
                </label>

                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 style="checkbox"/>
                        </p>
                    </template>
                    <render labName="CIEL:32" comment="Malaria smear"/>
                    <render labName="CIEL:1643" comment="Malaria RDT"/>
                    <render labName="CIEL:304" comment="Stool"/>
                </repeat>

                <br/><br/><br/>
                <includeIf velocityTest="$patient.gender == 'F' ">
                    <br/><br/><br/>
                </includeIf>
                <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) &lt; 2">
                    <br/>
                </includeIf>

                <!-- Biochemistry -->
                <p>
                    <label>
                        <uimessage code="pihcore.lab.biochemistry.title"/>
                    </label>
                </p>
                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 style="checkbox"/>
                        </p>
                    </template>
                    <render labName="CIEL:953"  comment="Liver (LFT)"/>
                    <render labName="CIEL:161488" comment="Renal (RFT)"/>
                    <render labName="CIEL:1010" comment="Lipid panel"/>
                    <render labName="CIEL:5473" comment="Electrolytes"/>
                    <render labName="CIEL:887"  comment="Glucose"/>
                    <render labName="PIH:12655" comment="BUN" />
                </repeat>

                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 answerCode="{comment}"
                                 style="checkbox"/>
                        </p>
                    </template>
                    <render labName="CIEL:164364" comment="Creatinine" />
                    <render labName="CIEL:653"  comment="AST / SGOT" />
                    <render labName="CIEL:654"  comment="ALT / SGPT" />
                </repeat>

                <p>
                    <label>
                        <uimessage code="pihcore.lab.serology.title"/>
                    </label>
                </p>
                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 style="checkbox"/>
                        </p>
                    </template>

                    <!-- Serology -->
                    <render labName="CIEL:163618" comment="Chlamydia"/>
                    <render labName="CIEL:1619"   comment="Syphilis (RPR)"/>
                    <render labName="CIEL:161475" comment="Hep B"/>
                    <render labName="CIEL:161474" comment="Hep C"/>
                    <render labName="CIEL:159645" comment="Spinal fluid (CSF)"/>
                    <render labName="CIEL:161500" comment="C-reactive protein"/>
                    <render labName="CIEL:163613" comment="CrAg"/>
                </repeat>
                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 answerCode="{codeLabel}"
                                 style="checkbox"/>
                        </p>
                    </template>

                    <!-- Serology continued -->
                    <render labName="CIEL:306" codeLabel="pihcore.lab.typhoid" comment="Typhoid (Widal)"/>
                    <render labName="CIEL:161469" codeLabel="ASO" comment="ASO"/>
                </repeat>

                <includeIf velocityTest="$patient.gender == 'F' ">
                    <br/><br/><br/>
                </includeIf>
                <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) &lt; 2">
                    <br/>
                </includeIf>

                <!-- TB -->
                <p>
                    <label>
                        <uimessage code="pihcore.lab.tb.title"/>
                    </label>
                </p>
                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 answerCode="{codeLabel}"
                                 style="checkbox"/>
                        </p>
                    </template>

                    <render labName="PIH:TUBERCULOSIS SMEAR RESULT" codeLabel="pihcore.lab.tbSmear"
                            comment="AFB / Smear"/>
                    <render labName="PIH:TUBERCULOSIS CULTURE RESULT" codeLabel="pihcore.lab.tbCulture"
                            comment="TB culture"/>
                    <render labName="CIEL:5475"   codeLabel="pihcore.lab.tbSkin" comment="PPD (skin test)"/>
                    <render labName="CIEL:164945" codeLabel="pihcore.lab.tbRIF" comment="GenXpert"/>
                </repeat>

                <!-- HIV -->
                <label>
                    <uimessage code="pihcore.lab.hiv.title"/>
                </label>

                <!-- Only for infant (less than 1) -->
                <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) &lt; 1">
                    <repeat>
                        <template>
                            <p>
                                <obs conceptId="PIH:Lab test ordered coded"
                                     answerConceptId="{labName}"
                                     answerCode="{codeLabel}"
                                     style="checkbox"/>
                            </p>
                        </template>
                        <render labName="CIEL:1030" codeLabel="pihcore.lab.hivpcr" comment="HIV PCR"/>
                    </repeat>
                </includeIf>

                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 answerCode="{codeLabel}"
                                 style="checkbox"/>
                        </p>
                    </template>

                    <render labName="CIEL:163722" codeLabel="pihcore.lab.hivRapid" comment="HIV RT"/>
                    <render labName="CIEL:1041" codeLabel="pihcore.lab.elisaQuant" comment="HIV ELISA Quant" />
                    <render labName="CIEL:856"  codeLabel="pihcore.lab.viralLoad" comment="HIV viral load"/>
                    <render labName="CIEL:5497" codeLabel="pihcore.lab.cd4" comment="CD4 count"/>
                    <render labName="CIEL:730"  codeLabel="pihcore.lab.cd4Percent" comment="CD4 %"/>
                    <render labName="CIEL:1047" codeLabel="Western blot" comment="Western blot (qual)" />
                </repeat>

                <!-- ANC -->
                <includeIf velocityTest="($patient.getAge($encounter.getEncounterDatetime()) &gt; 8) &amp;&amp; $patient.gender == 'F' ">
                    <p>
                        <label>
                            ANC
                        </label>
                    </p>
                    <repeat>
                        <template>
                            <p>
                                <obs conceptId="PIH:Lab test ordered coded"
                                     answerConceptId="{labName}"
                                     answerCode="{codeLabel}"
                                     style="checkbox"/>
                            </p>
                        </template>
                        <render labName="PIH:B-HCG" codeLabel="pihcore.lab.pregnancy" comment="Pregnancy"/>
                        <render labName="CIEL:165553" codeLabel="pihcore.lab.vaginal" comment="Vaginal discharge"/>
                    </repeat>
                </includeIf>

                <!-- Other -->
                <label>
                    <uimessage code="pihcore.other"/>
                </label>

                <includeIf velocityTest="($patient.getAge($encounter.getEncounterDatetime()) &gt; 25) &amp;&amp; $patient.gender == 'F' ">
                    <repeat>
                        <template>
                            <p>
                                <obs conceptId="PIH:Lab test ordered coded"
                                     answerConceptId="{labName}"
                                     answerCode="{comment}"
                                     style="checkbox"/>
                            </p>
                        </template>
                        <render labName="CIEL:885" comment="PAP test"/>
                    </repeat>
                </includeIf>

                <repeat>
                    <template>
                        <p>
                            <obs conceptId="PIH:Lab test ordered coded"
                                 answerConceptId="{labName}"
                                 answerCode="{comment}"
                                 style="checkbox"/>
                        </p>
                    </template>
                    <render labName="CIEL:302" comment="pihcore.lab.urine"/>
                    <render labName="CIEL:161454" comment="Gram stain"/>
                    <render labName="CIEL:163620" comment="H pylori"/>
                </repeat>
                <p>
                    <obs conceptId="PIH:Lab test ordered coded"
                         answerConceptId="PIH:OTHER"
                         answerCode="zl.ifOtherSpecify"
                         style="checkbox"
                         showCommentField="true" commentFieldLabel=""/>
                </p>

                <includeIf velocityTest="$patient.gender == 'M' ">
                    <br/><br/>
                </includeIf>
            </div>

            <!-- UHM-4784 Use Lab results or workflow to enter lab data.  Using includeif to comment out the section -->
            <includeIf velocityTest="$patient.gender == 'NoLabEntryHere' ">
                <h4>
                    <uimessage code="pihcore.lab.lab_results.title" />
                </h4>

                <table>
                    <repeat>
                        <template>
                            <tr>
                                <td>
                                    <obs conceptId="PIH:Lab test ordered coded"
                                         answerConceptId="{labName}"
                                         style="checkbox"
                                         toggle="{id: '{comment}-test', style: 'dim'}"/>
                                </td>
                                <td id="{comment}-test">
                                    <obs conceptId="{labName}" />
                                </td>
                            </tr>
                        </template>
                        <render labName="CIEL:887"    comment="Glucose"/>
                        <render labName="CIEL:307"    comment="Sputum"/>
                        <render labName="CIEL:5475"   comment="TBskin"/>
                        <render labName="CIEL:163613" comment="CrAg"/>
                        <render labName="CIEL:1619"   comment="RPRbio"/>
                        <render labName="CIEL:161469" comment="ASO"/>
                    </repeat>
                </table>
            </includeIf>
        </div>
    </section>

    <!-- Stolen from the dispensing module, but using prescription construct instead of dispensing -->
    <section id="id-treatment" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.treatment">

        <div class="section-container-color">
            <!-- this section is ONLY included for HIV intake encounter -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                <h4>
                    <uimessage code="pihcore.prophylaxis"/>
                </h4>

                <p>
                    <!-- Added yes NOT 'not indicated' to toggle this section -->
                    <obs conceptId="PIH:2740"
                         answerConceptId="CIEL:1065"
                         toggle="prophylaxisIndicated" />
                </p>

                <table class="prophylaxisIndicated">
                    <tr>
                        <td>
                            <label>
                                <uimessage code="pihcore.treatment" />
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.startDate" />
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.endDate" />
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.currentUse" />
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.stopReason" />
                            </label>
                        </td>
                    </tr>

                    <repeat>
                        <template>
                            <obsgroup groupingConceptId="PIH:10742">
                                <tr>
                                    <td>
                                        <obs conceptId="CIEL:1282" answerConceptId="{conceptMap}"
                                             answerLabel="{drugname}"
                                             toggle="{id: '{drugname}-treat', style: 'dim'}"/>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:163526" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:164384" allowFutureDates="true" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:159367" answerConceptId="CIEL:1065"
                                             answerLabel=""/>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <small>
                                            <obs conceptId="CIEL:6098"
                                                 answerConceptIds="CIEL:843,CIEL:1754,CIEL:102,CIEL:987,CIEL:1434,CIEL:5622" />
                                        </small>
                                    </td>
                                </tr>
                            </obsgroup>
                        </template>
                        <render conceptMap="CIEL:105281" drugname="Cotrimoxazole" />
                    </repeat>

                    <repeat>
                        <template>
                            <obsgroup groupingConceptId="PIH:10742">
                                <tr>
                                    <td>
                                        <obs conceptId="CIEL:1282" answerConceptId="{conceptMap}"
                                             answerLabel="{drugname}"
                                             toggle="{id: '{drugname}-treat', style: 'dim'}"/>
                                        <p class="radio {drugname}-treat">
                                            <obs conceptId="PIH:13154" style="radio"
                                                 answerConceptIds="CIEL:159943, CIEL:159944"
                                                 answerSeparator="&lt;br /&gt;"/>
                                        </p>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:163526" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:164384" allowFutureDates="true" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:159367" answerConceptId="CIEL:1065"
                                             answerLabel=""/>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <small>
                                            <obs conceptId="CIEL:6098"
                                                 answerConceptIds="CIEL:843,CIEL:1754,CIEL:102,CIEL:987,CIEL:1434,CIEL:5622" />
                                        </small>
                                    </td>
                                </tr>
                            </obsgroup>
                        </template>
                        <render conceptMap="CIEL:78280"  drugname="Isoniazide" />
                    </repeat>

                    <repeat>
                        <template>
                            <obsgroup groupingConceptId="PIH:10742">
                                <tr>
                                    <td>
                                        <obs conceptId="CIEL:1282" answerConceptId="{conceptMap}"
                                             answerLabel="{drugname}"
                                             toggle="{id: '{drugname}-treat', style: 'dim'}"/>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:163526" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:164384" allowFutureDates="true" />
                                    </td>
                                    <td class="{drugname}-treat">
                                        <obs conceptId="CIEL:159367" answerConceptId="CIEL:1065"
                                             answerLabel=""/>
                                    </td>
                                    <td class="{drugname}-treat">
                                        <small>
                                            <obs conceptId="CIEL:6098"
                                                 answerConceptIds="CIEL:843,CIEL:1754,CIEL:102,CIEL:987,CIEL:1434,CIEL:5622" />
                                        </small>
                                    </td>
                                </tr>
                            </obsgroup>
                        </template>
                        <render conceptMap="CIEL:76488"  drugname="Fluconazole" />
                        <render conceptMap="CIEL:74250"  drugname="Dapsone" />
                    </repeat>

                    <obsgroup groupingConceptId="PIH:10742">
                        <tr>
                            <td>
                                <obs conceptId="CIEL:1282"
                                     answerConceptId="PIH:3120" answerCode="pihcore.other"
                                     toggle="{id: '{other-pro-treat}', style: 'dim'}"
                                     commentFieldLabel="specify:" />
                            </td>
                            <td class="other-pro-treat">
                                <obs conceptId="CIEL:163526" />
                            </td>
                            <td class="other-pro-treat">
                                <obs conceptId="CIEL:164384" allowFutureDates="true" />
                            </td>
                            <td class="other-pro-treat">
                                <obs conceptId="CIEL:159367" answerConceptId="CIEL:1065"
                                     answerLabel=""/>
                            </td>
                            <td class="other-pro-treat">
                                <small>
                                    <obs conceptId="CIEL:6098"
                                         answerConceptIds="CIEL:843,CIEL:1754,CIEL:102,CIEL:987,CIEL:1434,CIEL:5622" />
                                </small>
                            </td>
                        </tr>
                    </obsgroup>
                </table>
            </includeIf>

            <!-- ARV Treatment -->
            <h4>
                <uimessage code="pihcore.arvTreatment"/>
            </h4>

            <div class="two-columns">
                <p class="radio">
                    <label>
                        <uimessage code="pihcore.hiv.needsART" />
                    </label>
                    <br/>

                    <obs conceptId="CIEL:162703" style="radio"
                         answerConceptIds="CIEL:1066,CIEL:127750,PIH:2222,PIH:1619,CIEL:160037,PIH:7262"
                         answerCodes="pihcore.noNotIndicated,pihcore.yesButRefused,pihcore.yesAfterCHW,pihcore.yesStartNow,pihcore.yesTreatmentStarted,pihcore.yesDelayed"
                         answerSeparator="&lt;br /&gt;" />
                    <!-- Reason about delay -->
                    <label>
                        <uimessage code="pihcore.ifYesReason"/>
                    </label>
                    <obs conceptId="PIH:13021" style="text"/>
                </p>

                <p>
                    <label>
                        <uimessage code="pihcore.hiv.startDateARV"/>
                    </label>
                    <obs conceptId="CIEL:159599"/>
                </p>
                <br/><br/>

                <p class="radio">
                    <label>
                        <!-- this label for HIV intake encounter -->
                        <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                            <uimessage code="pihcore.hiv.startRegimenName"/>:
                        </includeIf>
                        <!-- this label for HIV followup -->
                        <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                            <uimessage code="pihcore.specifyRegimen"/>:
                        </includeIf>
                    </label>

                    <br/>
                    <!-- ARV medications -->
                    <obsgroup groupingConceptId="PIH:6116">
                        <label>ARV</label>
                        <obs id="arv1Drug" conceptId="CIEL:1282"
                             answerConceptIds="CIEL:792,CIEL:164511,CIEL:160124,CIEL:1652,CIEL:164512,
                                CIEL:165086,CIEL:164505,CIEL:162565,CIEL:160104,CIEL:5622"
                        />

                        <!-- Other ARV -->
                        <label>
                            <uimessage code="pihcore.other" /> ARV:
                        </label>
                        <obs conceptId="CIEL:5424"/>

                        <br/>

                        <label>
                            <uimessage code="pihcore.treatmentLine" />
                        </label>
                        <obs conceptId="PIH:13115" style="radio"
                             answerConceptIds="PIH:7428,PIH:7429,PIH:7430" />
                    </obsgroup>
                <br/><br/><br/><br/>
                </p>
            </div>


            <br/><br/>
            <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                <label>
                    <uimessage code="pihcore.ifChangeSpecifyReason" />
                </label>

                <repeat>
                    <template>
                        <p>
                            <obs conceptId="CIEL:1252" answerConceptId="{reason}" style="checkbox"/>
                        </p>
                    </template>

                    <render reason="CIEL:843" name="Failure"/>
                    <render reason="CIEL:102" name="Toxicity"/>
                    <render reason="CIEL:162853" name="interaction"/>
                    <render reason="CIEL:127750" name="refusal"/>
                    <render reason="CIEL:1754" name="stockOut"/>
                    <render reason="CIEL:1434" name="pregnant"/>
                </repeat>

                <p>
                    <obs conceptId="CIEL:1252" answerConceptId="CIEL:5622"
                         style="checkbox" showCommentField="true" commentFieldLabel="" />
                </p>
        </includeIf>

            <includeIf velocityTest="$patient.gender == 'F' ">
                <br/>
                <div class="two-columns">
                    <p class="radio">
                        <label>
                            <uimessage code="pihcore.hiv.startARVforPMTCT"/>
                        </label>
                        <br/>
                        <obs conceptId="CIEL:5576" style="radio"
                             answerConceptIds="CIEL:1066,CIEL:1065"/>
                        <br/>
                        <br/>
                        <label>
                            <uimessage code="pihcore.ifyesTransferPMTCT" />?
                        </label>
                        <obs conceptId="PIH:8854" style="checkbox"
                             answerConceptId="PIH:6260" answerCode="emr.yes"/>
                    </p>
                </div>
            </includeIf>

            <!-- TB Treatment -->
            <br/>
            <h4>
                <uimessage code="pihcore.tbTreatment"/>
            </h4>
            <div class="two-columns">
                <p class="radio">
                    <label>
                        <uimessage code="pihcore.tb.needTreatment" />
                    </label>
                    <br/>

                    <!-- for HIV intake -->
                    <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                        <obs conceptId="PIH:1559" style="radio"
                             answerConceptIds="PIH:2224,CIEL:1066,CIEL:1065,PIH:1432"
                             answerCodes="pihcore.ongoingExam,emr.no,emr.yes,pihcore.treatmentStarted"
                             answerSeparator="&lt;br /&gt;" />
                    </includeIf>

                    <!-- for HIV followup -->
                    <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                        <obs conceptId="PIH:1559" style="radio"
                             answerConceptIds="CIEL:1066,CIEL:160017,CIEL:1267,CIEL:981,CIEL:163057"
                             answerCodes="pihcore.tb.medsNotIndicated,pihcore.tb.medsStarted,pihcore.tb.medsStopped,pihcore.tb.medsChanged,pihcore.tb.ongoing"
                             answerSeparator="&lt;br /&gt;" />
                        <br/><br/>
                    </includeIf>
                </p>

                <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                    <label>
                        <uimessage code="pihcore.startDate" />
                    </label>
                </includeIf>
                <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                    <label>Date</label>
                </includeIf>

                <obs conceptId="CIEL:1113" />

                <p class="radio">
                    <!-- this label for HIV intake encounter -->
                    <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
                        <uimessage code="pihcore.tb.startTBTreatmentComment" />
                    </includeIf>
                    <!-- this label for HIV followup -->
                    <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                        <uimessage code="pihcore.specifyRegimen"/>:
                    </includeIf>
                    <br/>
                    <obs conceptId="CIEL:159792" style="radio"
                         answerConceptIds="PIH:2406,PIH:2408,CIEL:159909"
                         answerCodes="pihcore.tb.initialTreatment,pihcore.tb.retreatment,pihcore.tb.mdrtbTreatment"
                         answerSeparator="&lt;br /&gt;" />
                </p>
            </div>

            <!-- HIV followup only-->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                <label>
                    <uimessage code="pihcore.ifChangeSpecifyReason" />:
                </label>
                <div class="three-columns">
                    <repeat>
                        <template>
                            <p>
                                <obs conceptId="CIEL:1269" answerConceptId="{reason}" style="checkbox" />
                            </p>
                        </template>
                        <render reason="CIEL:159794" name="Continue" />
                        <render reason="CIEL:981"    name="changeDose" />
                        <render reason="CIEL:160041" name="extended" />
                        <render reason="CIEL:102"    name="Toxicity" />
                        <render reason="CIEL:843"    name="Failure" />
                        <render reason="CIEL:159791" name="cured" />
                        <render reason="CIEL:1267"   name="complete" />
                        <render reason="CIEL:1754"   name="stockOut" />
                        <render reason="CIEL:5622"   name="other" />
                    </repeat>
                </div>
            </includeIf>

            <!-- STI screening for HIV followup -->
            <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
                <br/>
                <h4>
                    <uimessage code="pihcore.stiScreeningOnly"/>
                </h4>
                <div class="two-columns">
                    <repeat>
                        <template>
                            <p class="radio">
                                <label>
                                    <uimessage code="pihcore.{name}" />
                                </label>
                                <obs conceptId="{screen}" style="radio"
                                     answerConceptIds="CIEL:1065,CIEL:1066" />
                            </p>
                        </template>
                        <render screen="PIH:1816"    name="stiDischarge" />
                        <render screen="CIEL:163606" name="burnUrine" />
                        <render screen="CIEL:864"    name="genitalUlcer" />
                    </repeat>
                    <br/>
                    <label>
                        <uimessage code="pihcore.other"/>
                    </label>
                    <obs conceptId="PIH:1374" />
                </div>
            </includeIf>

        <!-- STI treatment -->
        <h4>
            <uimessage code="pihcore.stiTreatment"/>
        </h4>

        <!-- HIV intake only-->
        <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33'">
            <div class="two-columns">
                <p class="radio">
                    <label>
                        <uimessage code="pihcore.syph.needTreatment"/>
                    </label>
                    <br/>

                    <obs conceptId="CIEL:165331" style="radio"
                         answerConceptIds="PIH:2224,CIEL:1066,CIEL:1065,CIEL:160037"
                         answerCodes="pihcore.ongoingExam,emr.no,emr.yes,pihcore.treatmentStarted"
                         answerSeparator="&lt;br /&gt;"/>
                </p>

                <label>
                    <uimessage code="pihcore.startDate"/>
                </label>
                <obs conceptId="PIH:13023"/>

                <br/>
                <br/>
                <br/>
                <p>
                    <label>
                        <uimessage code="pihcore.syph.patientNeedsOtherTreatment"/>
                    </label>
                    <table>
                        <tr>
                            <td>
                                <label>
                                    <uimessage code="pihcore.regimen"/>
                                </label>
                            </td>
                            <td>
                                <label>
                                    <uimessage code="providermanagement.startDate"/>
                                </label>
                            </td>
                        </tr>

                        <repeat with="['1'],['2'],['3']">
                            <obsgroup groupingConceptId="PIH:13027">
                                <tr>
                                    <td>
                                        <!-- Toggle doesn't work with text -->
                                        <obs conceptId="PIH:10637" style="text"/>
                                    </td>
                                    <td>
                                        <obs conceptId="CIEL:1428"/>
                                    </td>
                                </tr>
                            </obsgroup>
                        </repeat>
                    </table>
                </p>
            </div>
            <p>
                <label>
                    <uimessage code="pihcore.remarks"/>
                </label>
                <obs conceptId="PIH:1374" style="text" rows="2" cols="40"/>
            </p>
        </includeIf>

        <!-- HIV followup only-->
        <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d3312-40c4-11e7-a919-92ebcb67fe33'">
            <label>
                <uimessage code="pihcore.syph.needTreatment"/>
            </label>
            <p class="small">
                <obs id="syph-treatment-need"
                     conceptId="CIEL:165331" style="radio"
                     answerConceptIds="CIEL:1065,CIEL:1066"
                     answerCodes="emr.yes,emr.no"
                     answerSeparator="">
                    <controls>
                        <when value="CIEL:1065" thenDisplay="#start-date-syph-treatment"/>
                    </controls>
                </obs>
            </p>

            <div id="start-date-syph-treatment">
                <label>
                    <uimessage code="pihcore.ifYesStartDate"/>
                </label>
                <obs conceptId="PIH:13023"/>
            </div>

            <!--Other STD -->
            <label>
                <uimessage code="pihcore.treatmentNeededOtherSTI"/>?
            </label>
            <p class="small">
                <obs id="other-sti-treatment-need"
                     conceptId="PIH:13077" style="radio"
                     answerConceptIds="CIEL:1065,CIEL:1066"
                     answerSeparator="">
                    <controls>
                        <when value="CIEL:1065" thenDisplay="#other-sti-details"/>
                    </controls>
                </obs>
            </p>

            <div id="other-sti-details">
                <obsgroup groupingConceptId="PIH:13027">
                    <label>
                        <uimessage code="pihcore.mch.otherSTI" />
                    </label>
                    <repeat>
                        <template>
                            <p>
                                <obs conceptId="PIH:13076"
                                     answerConceptId="{stiDiag}"
                                     style="checkbox"/>
                            </p>
                        </template>
                        <render stiDiag="PIH:7247" comment="Chlamydia"/>
                        <render stiDiag="CIEL:117767" comment="Gonorrhea"/>
                        <render stiDiag="CIEL:117829" comment="GenitalHerpes"/>
                        <render stiDiag="CIEL:1213" comment="HPV"/>
                        <render stiDiag="CIEL:111759" comment="HepB"/>
                    </repeat>

                    <p>
                        <obs conceptId="PIH:13076"
                             answerConceptId="CIEL:5622"
                             style="checkbox" showCommentField="true" commentFieldLabel=""/>
                    </p>

                    <p class="narrow">
                        <label>
                            <uimessage code="pihcore.startDate"/>
                        </label>
                        <obs conceptId="CIEL:1428"/>
                    </p>
                </obsgroup>
            </div>
        </includeIf>
        </div>
    </section>

    <!-- this section is ONLY included for HIV intake encounter -->
    <includeIf velocityTest="$encounter.encounterType.uuid == 'c31d306a-40c4-11e7-a919-92ebcb67fe33' &amp;&amp; ($patient.getAge($encounter.getEncounterDatetime()) &gt; 13)">
        <section id="family-plan-section" sectionTag="fieldset"
                 headerTag="legend" headerStyle="title"
                 headerCode="pihcore.familyPlanning.title">

            <div class="section-container-color">
                <div class="two-columns">
                    <repeat>
                        <template>
                            <p>
                                <obsgroup groupingConceptId="PIH:Family planning construct">
                                    <obs conceptId="CIEL:374"
                                         answerConceptId="{fpMethod}"
                                         style="checkbox" />
                                </obsgroup>
                            </p>
                        </template>
                        <render fpMethod="CIEL:190" comment="Condoms"/>
                        <render fpMethod="CIEL:780" comment="Pill"/>
                        <render fpMethod="CIEL:1472" comment="Tubal ligation"/>
                        <render fpMethod="CIEL:1489" comment="Vasectomy"/>
                        <render fpMethod="CIEL:5275" comment="IUD"/>
                        <render fpMethod="CIEL:907" comment="Depo-provera"/>
                        <render fpMethod="CIEL:78796" comment="Norplant"/>
                        <render fpMethod="CIEL:159524" comment="Abstinence"/>
                        <render fpMethod="CIEL:1107" comment="None"/>
                        <render fpMethod="CIEL:5622" comment="Other"/>
                    </repeat>
                </div>

                <p>
                    <label>
                        <uimessage code="pihcore.remarks"/>:
                    </label>
                    <obs conceptId="PIH:FAMILY PLANNING COMMENT" style="text"/>
                </p>
            </div>
        </section>
    </includeIf>

    <section id="assistance" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.socioEconAssist">
        <div class="section-container-color">
            <table>
                <tr>
                    <td></td>
                    <th>
                        <label>
                            <uimessage code="pihcore.received"/>
                        </label>
                    </th>
                    <th>
                        <label>
                            <uimessage code="pihcore.recommended"/>
                        </label>
                    </th>
                </tr>

                <repeat>
                    <template>
                        <tr>
                            <td>
                                <label>
                                    <uimessage code="{aidLabel}"/>
                                </label>
                            </td>
                            <td>
                                <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE ALREADY RECEIVED"
                                     answerConceptId="{aid}"
                                     answerLabel="" style="checkbox"/>
                            </td>
                            <td>
                                <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE RECOMMENDED"
                                     answerConceptId="{aid}"
                                     answerLabel="" style="checkbox"/>
                            </td>
                        </tr>
                    </template>
                    <render aid="PIH:ASSISTANCE WITH TRANSPORT" aidLabel="pihcore.aid.transport"/>
                    <render aid="PIH:NUTRITIONAL AID" aidLabel="pihcore.aid.food"/>
                </repeat>

                <tr>
                    <td>
                        <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE NON-CODED"
                             labelCode="zl.ifOtherSpecify"/>
                    </td>
                    <td>
                        <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE ALREADY RECEIVED"
                             answerConceptId="CIEL:5622"
                             answerLabel="" style="checkbox"/>
                    </td>
                    <td>
                        <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE RECOMMENDED"
                             answerConceptId="CIEL:5622"
                             answerLabel="" style="checkbox"/>
                    </td>
                </tr>

            </table>

            <p>
                <label>
                    <uimessage code="pihcore.remarks"/>:
                </label>
                <obs conceptId="PIH:SOCIO-ECONOMIC ASSISTANCE COMMENT" style="text"/>
            </p>
        </div>
    </section>

    <section id="transfer-out-section" sectionTag="fieldset"
             headerTag="legend" headerStyle="title" headerCode="pihcore.transfer.title">
        <div class="section-container-color">
            <obsgroup groupingConceptId="PIH:13170">
                <label>
                    <uimessage code="pihcore.externalTransferQuestion" />
                </label>
                <p class="radio cb-align">
                    <obs conceptId="PIH:HUM Disposition categories"
                         answerConceptId="CIEL:160036" answerCode="emr.yes"
                         style="checkbox" toggle="transfer-out-details"/>
                </p>

                <div id="transfer-out-details">
                    <p class="small">
                        <obs id="transfer-out-spots"
                             conceptId="PIH:Transfer out location" style="radio"
                             answerConceptIds="PIH:8855,PIH:8856"
                             answerCodes="pihcore.internal,pihcore.external"
                             answerSeparator="">
                            <controls>
                                <when value="PIH:8855" thenDisplay="#internal-transfer-out"/>
                                <when value="PIH:8856" thenDisplay="#external-transfer-out"/>
                            </controls>
                        </obs>
                    </p>

                    <p id="internal-transfer-out">
                        <label>
                            <uimessage code="pihcore.internalTransferLocation" />
                        </label>
                        <obs conceptId="PIH:8621" style="location" answerLocationTags="Program Location" />
                    </p>

                    <p id="external-transfer-out">
                            <label>
                                <uimessage code="pihcore.externalTransferLocation"/>
                            </label>
                            <obs conceptId="PIH:11483" />
                            <obs conceptId="PIH:PEPFAR partner site"
                                 answerConceptId="CIEL:1065" answerCode="pihcore.pepfarSite" />
                    </p>
                </div>
            </obsgroup>
        </div>
    </section>

    <section id="hiv-disposition-section" sectionTag="fieldset"
             headerTag="legend" headerStyle="title"
             headerCode="pihcore.planConclusion">

        <div class="section-container-color">

            <label>
                <uimessage code="pihcore.consult.clinicalImpressions"/>
            </label>
            <obs conceptId="CIEL:162749" style="text"/>

            <label>
                <uimessage code="pihcore.actionPlan"/>
            </label>
            <obs conceptId="PIH:1620" style="text"/>

            <p class="narrow">
                <label>
                    <lookup expression="fn.getConcept('PIH:RETURN VISIT DATE').name"/>
                </label>
                <obs conceptId="PIH:RETURN VISIT DATE" allowFutureDates="true" id="apptDate"/>
            </p>

        </div>

    </section>

    <script>
        jq(function() {
            let providerBox = jq("#provider-name-non-coded input");
            if(providerBox.val()) {
                providerBox.attr("disabled", "disabled");
            } else {
                jq("#provider").hide();
            }
        });
    </script>

    <section id="provider" sectionTag="fieldset"
             headerTag="legend" headerStyle="title"
             headerCode="pihcore.provider">

        <div class="section-container-color">
            <label>
                <uimessage code="pihcore.provider"/>
            </label>
            <obs id="provider-name-non-coded" conceptId="PIH:Provider name non-coded" disabled="disabled" size="50" />
        </div>
    </section>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <submit submitClass="confirm right" submitCode="emr.save"/>
            <button type="button" class="cancel">
                <uimessage code="emr.cancel"/>
            </button>
        </div>
    </ifMode>

</htmlform>
